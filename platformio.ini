; PlatformIO Project Configuration File for FastBLEOTA
;
; This configuration allows testing the library with different boards.
; The library source is in src/ and examples are in examples/.
;
; Build commands:
;   pio run -e esp32dev           # Build basic example for ESP32
;   pio run -e esp32s3            # Build basic example for ESP32-S3
;   pio run -e esp32_modular      # Build modular example for ESP32
;   pio run -e nrf52840_dk        # Build for nRF52840 DK
;   pio run -e pro_micro_nrf52840 # Build for Pro Micro nRF52840
;   pio run                       # Build all default environments
;
; Copyright (c) 2024-2026 Leeor Nahum

[platformio]
; Library mode: src_dir is the library, examples can be selected
src_dir = examples/basic
lib_dir = .
default_envs = esp32dev

[env]
framework = arduino
monitor_speed = 115200

; Common build flags
build_flags =
  -D FBO_ENABLE_CRC=true
  -D FBO_ENABLE_FLOW_CONTROL=true
  ; Uncomment for verbose logging:
  ; -D FBO_DEBUG

; Library dependencies
lib_deps =
  h2zero/NimBLE-Arduino@^2.0.0
  arduino-libraries/Arduino_CRC32@^1.0.0

; =============================================================================
; ESP32 Environments
; =============================================================================

[env:esp32dev]
platform = espressif32
board = esp32dev

[env:esp32s3]
platform = espressif32
board = esp32-s3-devkitm-1
build_flags =
  ${env.build_flags}
  -D ARDUINO_USB_MODE=1
  -D ARDUINO_USB_CDC_ON_BOOT=1

[env:esp32c3]
platform = espressif32
board = esp32-c3-devkitm-1

; Modular example (zero FBO code in main - all in ble/ wrapper)
[env:esp32_modular]
platform = espressif32
board = esp32dev
build_src_filter = +<../examples/modular/>
build_flags =
  ${env.build_flags}
  -D FBO_DEBUG
  ; Demo message changes each build (use to verify OTA worked)
  '-D DEMO_MESSAGE="Build ${UNIX_TIME}"'

[env:esp32s3_modular]
platform = espressif32
board = esp32-s3-devkitm-1
build_src_filter = +<../examples/modular/>
build_flags =
  ${env.build_flags}
  -D ARDUINO_USB_MODE=1
  -D ARDUINO_USB_CDC_ON_BOOT=1
  -D FBO_DEBUG
  '-D DEMO_MESSAGE="Build ${UNIX_TIME}"'

; =============================================================================
; nRF52 Environments
; =============================================================================

; Nordic nRF52840 Development Kit
; Requires Adafruit nRF52 platform
[env:nrf52840_dk]
platform = https://github.com/maxgerhardt/platform-n-able.git#master
board = nrf52840_dk
build_flags =
  ${env.build_flags}
  -D NRF52_SERIES
lib_deps =
  ${env.lib_deps}

; Adafruit Feather nRF52840
[env:feather_nrf52840]
platform = https://github.com/maxgerhardt/platform-n-able.git#master
board = adafruit_feather_nrf52840
build_flags =
  ${env.build_flags}
  -D NRF52_SERIES
lib_deps =
  ${env.lib_deps}

; nRF52832 DK - Note: Has less flash than nRF52840
; The nRF52832 has 512KB flash total vs 1MB on nRF52840
; This means smaller OTA staging area (~200KB usable)
[env:nrf52832_dk]
platform = https://github.com/maxgerhardt/platform-n-able.git#master
board = nrf52_dk
build_flags =
  ${env.build_flags}
  -D NRF52_SERIES
lib_deps =
  ${env.lib_deps}

; Pro Micro nRF52840
; Custom Pro Micro form factor board with nRF52840
[env:pro_micro_nrf52840]
platform = https://github.com/LeeorNahum/platform-n-able-pro-micro-nrf52840.git#master
board = pro_micro_nrf52840
build_flags =
  ${env.build_flags}
  -D NRF52_SERIES
lib_deps =
  ${env.lib_deps}

; =============================================================================
; Test Configurations
; =============================================================================

; Minimal build test (no extra features)
[env:esp32_minimal]
platform = espressif32
board = esp32dev
build_flags =
  -D FBO_ENABLE_CRC=false
  -D FBO_ENABLE_FLOW_CONTROL=false

; Full features test with fast ACK
[env:esp32_full]
platform = espressif32
board = esp32dev
build_flags =
  ${env.build_flags}
  -D FBO_ACK_INTERVAL=10
